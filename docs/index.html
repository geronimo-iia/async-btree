

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Async Behaviour Tree for Python &mdash; async_btree 1.1.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> async_btree
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_of_conduct.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/geronimo-iia/async-btree">Github</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">async_btree</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>Async Behaviour Tree for Python</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="async-behaviour-tree-for-python">
<span id="index"></span><h1>Async Behaviour Tree for Python<a class="headerlink" href="#async-behaviour-tree-for-python" title="Permalink to this headline">¶</a></h1>
<a class="reference external image-reference" href="https://travis-ci.com/geronimo-iia/async-btree"><img alt="Unix Build Status" src="https://img.shields.io/travis/geronimo-iia/async-btree/master.svg?label=unix" /></a>
<a class="reference external image-reference" href="https://coveralls.io/r/geronimo-iia/async-btree"><img alt="Coverage Status" src="https://img.shields.io/coveralls/geronimo-iia/async-btree/master.svg" /></a>
<a class="reference external image-reference" href="https://www.codacy.com/app/geronimo-iia/async-btree?utm_source=github.com&amp;amp;utm_medium=referral&amp;amp;utm_content=geronimo-iia/async-btree&amp;amp;utm_campaign=Badge_Grade"><img alt="Codacy Badge" src="https://api.codacy.com/project/badge/Grade/fe669a02b4aa46b5b1faf619ba2bf382" /></a>
<a class="reference external image-reference" href="https://scrutinizer-ci.com/g/geronimo-iia/async-btree/?branch=master"><img alt="Scrutinizer Code Quality" src="https://img.shields.io/scrutinizer/g/geronimo-iia/async-btree.svg" /></a>
<a class="reference external image-reference" href="https://pypi.org/project/async-btree"><img alt="PyPI Version" src="https://img.shields.io/pypi/v/async-btree.svg" /></a>
<a class="reference external image-reference" href="https://pypi.org/project/async-btree"><img alt="PyPI License" src="https://img.shields.io/pypi/l/async-btree.svg" /></a>
<p>Versions following <a class="reference external" href="https://semver.org/">Semantic Versioning</a></p>
<p>See <a class="reference external" href="https://geronimo-iia.github.io/async-btree">documentation</a>.</p>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-s-a-behavior-tree">
<h3>What’s a behavior tree ?<a class="headerlink" href="#what-s-a-behavior-tree" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Unlike a Finite State Machine, a Behaviour Tree is a tree of hierarchical nodes that controls the flow of decision and the execution of “tasks” or, as we will call them further, “Actions”.
– <span class="raw-html-m2r"><cite>[behaviortree](https://www.behaviortree.dev/bt_basics/)</cite></span></p>
</div></blockquote>
<p>If your new (or not) about behavior tree, you could spend some time on this few links:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.gamasutra.com/blogs/ChrisSimpson/20140717/221339/Behavior_trees_for_AI_How_they_work.php">Behavior trees for AI: How they work</a> by Chris Simpson</p></li>
<li><p><a class="reference external" href="https://www.behaviortree.dev/bt_basics/">Introduction to BTs</a></p></li>
</ul>
<p>Few implementation libraries:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ToyotaResearchInstitute/task_behavior_engine">task_behavior_engine</a> A behavior tree based task engine written in Python</p></li>
<li><p><a class="reference external" href="https://github.com/pirobot/pi_trees/">pi_trees</a> a Python/ROS library for implementing Behavior Trees</p></li>
<li><p><a class="reference external" href="https://github.com/personalrobotics/pr_behavior_tree">pr_behavior_tree</a> A simple python behavior tree library based on coroutines</p></li>
<li><p><a class="reference external" href="https://github.com/aigamedev/btsk">btsk</a> Behavior Tree Starter Kit</p></li>
<li><p><a class="reference external" href="https://github.com/fuchen/behave">behave</a> A behavior tree implementation in Python</p></li>
</ul>
</div>
<div class="section" id="why-another-library-so">
<h3>Why another library so ?<a class="headerlink" href="#why-another-library-so" title="Permalink to this headline">¶</a></h3>
<p><strong>SIMPLICITY</strong></p>
<p>When you study behavior tree implementation, reactive node, dynamic change, runtime execution, etc …
At a moment you’re build more or less something that mimic an evaluator ‘eval/apply’ or a compilator, with a complex hierachical set of class.</p>
<p>All complexity came with internal state management, using tree of blackboard to avoid global variable, multithreading issue, maybe few callback etc …</p>
<p>This break the simplicity and beauty of your initial design.</p>
<p>What I find usefull with behavior tree:</p>
<ul class="simple">
<li><p>clarity of expression</p></li>
<li><p>node tree representation</p></li>
<li><p>possibility to reuse behavior</p></li>
<li><p>add external measure to dynamicaly change a behavior, a first step on observable pattern…</p></li>
</ul>
<p>As I’ve used OOP for years (very long time), I will try to avoid class tree and prefer using the power of functionnal programming to obtain what I want: add metadata on a sematic construction, deal with closure, use function in parameters or in return value…</p>
<p>And a last reason, more personal, it that i would explore python expressivity.</p>
<p><strong>SO HOW ?</strong></p>
<p>In this module, I purpose you to use the concept of coroutines, and their mecanisms to manage the execution flow.
By this way:</p>
<ul class="simple">
<li><p>we reuse simple language idiom to manage state, parameter, etc</p></li>
<li><p>no design constraint on action implementation</p></li>
<li><p>most of language build block could be reused</p></li>
</ul>
<p>You could build expression like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">a_func</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;A great function&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;a&quot;</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">b_decorator</span><span class="p">(</span><span class="n">child_value</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A great decorator...&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;b</span><span class="si">{</span><span class="n">child_value</span><span class="si">}{</span><span class="n">other</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">assert</span> <span class="n">run</span><span class="p">(</span><span class="n">decorate</span><span class="p">(</span><span class="n">a_func</span><span class="p">,</span> <span class="n">b_decorator</span><span class="p">))</span> <span class="o">==</span> <span class="s2">&quot;ba&quot;</span>
</pre></div>
</div>
<p>This expression apply <code class="docutils literal notranslate"><span class="pre">b_decorator</span></code> on function <code class="docutils literal notranslate"><span class="pre">a_func</span></code>.
Note that <code class="docutils literal notranslate"><span class="pre">decorate(a_func,</span> <span class="pre">b_decorator)</span></code> is not an async function, only action, or condition are async function.</p>
<p>Few guidelines of this implementation:</p>
<ul class="simple">
<li><p>In order to mimic all NodeStatus (success, failure, running), I replace this by truthy/falsy meaning of evaluation value.
A special dedicated exception decorate standard exception in order to give them a Falsy meaning (<code class="docutils literal notranslate"><span class="pre">ControlFlowException</span></code>).
By default, exception are raised like happen usually until you catch them.</p></li>
<li><p>Blackboard pattern, act as a manager of context variable for behavior tree.
With python 3, please… simply use <a class="reference external" href="https://docs.python.org/3/library/contextvars.html">contextvars</a> !</p></li>
<li><p>In order to be able to build a sematic tree, I’ve introduce a metadata tuple added on function implementation.</p></li>
</ul>
<p>The rest is just implementation details..</p>
<p>A little note:</p>
<blockquote>
<div><p>You should not use this until you’re ready to think about what you’re doing :)</p>
</div></blockquote>
</div>
<div class="section" id="note-about-async-framework">
<h3>Note about ‘async’ framework<a class="headerlink" href="#note-about-async-framework" title="Permalink to this headline">¶</a></h3>
<p>As we use async function as underlaying mechanism to manage the execution flow, the standard library asyncio is pretty fine.
But, (always a but somewhere isn’t it…), you should read this [amazing blog post}(<a class="reference external" href="https://vorpus.org/blog/some-thoughts-on-asynchronous-api-design-in-a-post-asyncawait-world/">https://vorpus.org/blog/some-thoughts-on-asynchronous-api-design-in-a-post-asyncawait-world/</a>) by Nathaniel J. Smith.
And next study <a class="reference external" href="https://github.com/dabeaz/curio">curio</a> framework in deep.</p>
<p>As curio say:</p>
<blockquote>
<div><p>Don’t Use Curio if You’re Allergic to Curio</p>
</div></blockquote>
<p>Personaly, after few time of testing and reading curio code, I’m pretty addict.</p>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Install this library directly into an activated virtual environment:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ pip install async-btree
</pre></div>
</div>
<p>or add it to your <a class="reference external" href="https://poetry.eustace.io/">Poetry</a> project:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ poetry add async-btree
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>After installation, the package can imported:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ python
&gt;&gt;&gt; import async_btree
&gt;&gt;&gt; async_btree.__version__
</pre></div>
</div>
<p>See <a class="reference external" href="https://geronimo-iia.github.io/async-btree">API Reference documentation</a>.</p>
<p>With this framework, you didn’t find any configuration file, no Xml, no json, no yaml.</p>
<p>The main reason (oriented and personal point of view) is that you did not need to introduce an extra level of abtraction
to declare a composition of functions. I think it’s true for most of main use case (except using an editor to wrote behaviour tree for example).</p>
<p>So “If you wrote your function with python, wrote composition in python”…
<em>(remember that you did not need XML to do SQL, just write good sql…)</em></p>
<p>So, the goal is to:</p>
<ul class="simple">
<li><p>define your business function wich implements actions or conditions, with all test case that you wish/need</p></li>
<li><p>compose them using those provided by this framework like <code class="docutils literal notranslate"><span class="pre">sequence</span></code>, <code class="docutils literal notranslate"><span class="pre">selector</span></code>, …</p></li>
<li><p>use them as it is or create a well define python module to reuse them</p></li>
</ul>
<p>Wanna style have an abtract tree of our behaviour tree ?</p>
<p>Functions from async-btree build an abstract tree for you.
If you lookup in code, you should see an annotation “node_metadata” on internal implementation.
This decorator add basic information like function name, parameters, and children relation ship.</p>
<p>This abstract tree can be retreived and stringified with <code class="docutils literal notranslate"><span class="pre">analyze</span></code> and <code class="docutils literal notranslate"><span class="pre">stringify_analyze</span></code>.
Here the profile:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="n">CallableFunction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span> <span class="c1"># here we have our &quot;abtract tree code&quot;</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># your behaviour tree, or a sub tree:</span>
<span class="n">my_func</span> <span class="o">=</span> <span class="n">alias</span><span class="p">(</span><span class="n">child</span><span class="o">=</span><span class="n">repeat_until</span><span class="p">(</span><span class="n">child</span><span class="o">=</span><span class="n">action</span><span class="p">(</span><span class="n">hello</span><span class="p">),</span> <span class="n">condition</span><span class="o">=</span><span class="n">success_until_zero</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;btree_1&quot;</span><span class="p">)</span>

<span class="c1"># retrieve meta information and build a Node tree</span>
<span class="n">abstract_tree_tree_1</span> <span class="o">=</span> <span class="n">analyze</span><span class="p">(</span><span class="n">my_func</span><span class="p">)</span>

<span class="c1"># output the tree:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stringify_analyze</span><span class="p">(</span><span class="n">abstract_tree_tree_1</span><span class="p">))</span>
</pre></div>
</div>
<p>This should print:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>--&gt; btree_1:
    --(child)--&gt; repeat_until:
        --(condition)--&gt; success_until_zero:
        --(child)--&gt; action:
                     target: hello
</pre></div>
</div>
<p>Note about action and condition method:</p>
<ul class="simple">
<li><p>you could use sync or async function</p></li>
<li><p>you could specify a return value with SUCCESS or FAILURE</p></li>
<li><p>function with no return value will be evaluated as FAILURE until you decorate them with a <code class="docutils literal notranslate"><span class="pre">always_success</span></code>or <code class="docutils literal notranslate"><span class="pre">always_failure</span></code></p></li>
</ul>
<p>See this <a class="reference external" href="https://raw.githubusercontent.com/geronimo-iia/async-btree/master/examples/tutorial_1.py">example/tutorial_1.py</a> for more information.</p>
</div>
</div>
<div class="section" id="contents">
<h1>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_of_conduct.html">Contributor Covenant Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/geronimo-iia/async-btree">Github</a></li>
</ul>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Jerome Guibert

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>